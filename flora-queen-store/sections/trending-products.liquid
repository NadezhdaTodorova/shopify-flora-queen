{% comment %}
  FloraQueen Trending Products Section
  Features: Product carousel with price, rating, and hover effects
{% endcomment %}

<section class="trending-section" data-section-id="{{ section.id }}">
  <div class="container">
    <div class="section-header">
      <h2 class="section-header__title">{{ section.settings.section_title | default: 'Trending now' }}</h2>
      <a href="{{ section.settings.view_all_url | default: '/collections/all' }}" class="section-header__link">
        {{ section.settings.view_all_text | default: 'View all products' }}
        <svg width="16" height="16" viewBox="0 0 16 16">
          <path d="M1 8h14M8 1l7 7-7 7" stroke="currentColor" fill="none" stroke-width="1.5"/>
        </svg>
      </a>
    </div>

    <div class="products-grid">
        {% assign collection = collections[section.settings.collection] | default: collections.all %}
        {% for product in collection.products limit: section.settings.products_limit %}
          <div class="product-card">
            <a href="{{ product.url }}" class="product-card__link">
              <div class="product-card__image-wrapper">
                {% if product.featured_image %}
                  {{ product.featured_image | image_url: width: 400 | image_tag:
                    class: 'product-card__image',
                    loading: 'lazy',
                    widths: '200, 300, 400',
                    alt: product.featured_image.alt | default: product.title
                  }}
                {% else %}
                  <div class="product-card__placeholder">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none">
                      <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" stroke="#DDD" stroke-width="2"/>
                    </svg>
                  </div>
                {% endif %}

                {% if product.compare_at_price > product.price %}
                  <span class="product-card__badge">
                    {{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}% OFF
                  </span>
                {% endif %}

                <button class="product-card__quickview" data-product-id="{{ product.id }}" aria-label="Quick view">
                  <svg width="20" height="20" viewBox="0 0 24 24">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" fill="none"/>
                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" fill="none"/>
                  </svg>
                </button>
              </div>

              <div class="product-card__info">
                <h3 class="product-card__title">{{ product.title }}</h3>

                <div class="product-card__rating">
                  {% assign rating = product.metafields.reviews.rating | default: 4.5 %}
                  {% assign rating_count = product.metafields.reviews.count | default: 120 %}
                  <div class="stars" data-rating="{{ rating }}">
                    {% for i in (1..5) %}
                      <svg class="star {% if i <= rating %}star--filled{% endif %}" width="16" height="16">
                        <use xlink:href="#icon-star"></use>
                      </svg>
                    {% endfor %}
                  </div>
                  <span class="rating-count">({{ rating_count }})</span>
                </div>

                <div class="product-card__price">
                  {% if product.compare_at_price > product.price %}
                    <span class="price price--sale">{{ product.price | money }}</span>
                    <span class="price price--compare">{{ product.compare_at_price | money }}</span>
                  {% else %}
                    <span class="price">{{ product.price | money }}</span>
                  {% endif %}
                </div>

                {% if section.settings.show_sizes and product.has_only_default_variant == false %}
                  <div class="product-card__sizes">
                    {% for variant in product.variants limit: 3 %}
                      <span class="size-option">{{ variant.title }}</span>
                    {% endfor %}
                  </div>
                {% endif %}
              </div>
            </a>

            <form action="/cart/add" method="post" class="product-card__form" data-product-form>
              <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
              <button type="submit" class="product-card__add-to-cart" {% unless product.available %}disabled{% endunless %}>
                {% if product.available %}
                  <svg width="20" height="20" viewBox="0 0 24 24">
                    <path d="M9 2L6 9H22L19 2H9Z" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M6 9H6.01" stroke="currentColor" stroke-width="2"/>
                    <circle cx="9" cy="20" r="1" fill="currentColor"/>
                    <circle cx="20" cy="20" r="1" fill="currentColor"/>
                    <path d="M6 9h16l-1 7H7L6 9Z" stroke="currentColor" stroke-width="2" fill="none"/>
                  </svg>
                  <span>Add to Cart</span>
                {% else %}
                  <span>Sold Out</span>
                {% endif %}
              </button>
            </form>
          </div>
        {% endfor %}
    </div>
  </div>
</section>

<!-- Star Icon SVG Definition -->
<svg style="display: none;">
  <symbol id="icon-star" viewBox="0 0 24 24">
    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="currentColor"/>
  </symbol>
</svg>

{% stylesheet %}
  /* Trending Section */
  .trending-section {
    padding: 60px 0;
    background: #FFFFFF;
  }

  /* Section Header */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 40px;
    flex-wrap: wrap;
    gap: 20px;
  }

  .section-header__title {
    font-size: 28px;
    font-weight: 700;
    color: #2C3E50;
    margin: 0;
  }

  .section-header__link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: #666;
    text-decoration: none;
    font-weight: 500;
    font-size: 14px;
    transition: gap 0.3s ease, color 0.3s ease;
  }

  .section-header__link:hover {
    gap: 12px;
    color: #FF6B6B;
  }

  /* Products Grid */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 24px;
  }

  /* Product Card */
  .product-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid #E5E5E5;
  }

  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  .product-card__link {
    text-decoration: none;
    color: inherit;
  }

  .product-card__image-wrapper {
    position: relative;
    height: 280px;
    background: #F8F8F8;
    overflow: hidden;
  }

  .product-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .product-card:hover .product-card__image {
    transform: scale(1.05);
  }

  .product-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #F5F5F5;
  }

  .product-card__badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: #FF6B6B;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }

  .product-card__quickview {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: white;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .product-card:hover .product-card__quickview {
    opacity: 1;
  }

  .product-card__quickview:hover {
    background: #FF6B6B;
    color: white;
  }

  /* Product Info */
  .product-card__info {
    padding: 16px;
  }

  .product-card__title {
    font-size: 16px;
    font-weight: 500;
    color: #2C3E50;
    margin: 0 0 8px 0;
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  /* Rating */
  .product-card__rating {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 12px;
  }

  .stars {
    display: flex;
    gap: 2px;
  }

  .star {
    color: #E5E5E5;
  }

  .star--filled {
    color: #FFB800;
  }

  .rating-count {
    font-size: 12px;
    color: #999;
  }

  /* Price */
  .product-card__price {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
  }

  .price {
    font-size: 18px;
    font-weight: 700;
    color: #2C3E50;
  }

  .price--sale {
    color: #FF6B6B;
  }

  .price--compare {
    font-size: 14px;
    font-weight: 400;
    color: #999;
    text-decoration: line-through;
  }

  /* Sizes */
  .product-card__sizes {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
  }

  .size-option {
    padding: 4px 8px;
    border: 1px solid #E5E5E5;
    border-radius: 4px;
    font-size: 12px;
    color: #666;
  }

  /* Add to Cart */
  .product-card__add-to-cart {
    width: 100%;
    padding: 12px;
    background: white;
    border: 2px solid #FF6B6B;
    color: #FF6B6B;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s ease;
    margin: 0 16px 16px;
    width: calc(100% - 32px);
  }

  .product-card__add-to-cart:hover:not(:disabled) {
    background: #FF6B6B;
    color: white;
  }

  .product-card__add-to-cart:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Cart Notification */
  .cart-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #4CAF50;
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .products-grid {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .trending-section {
      padding: 40px 0;
    }

    .section-header__title {
      font-size: 24px;
    }

    .products-grid {
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }

    .product-card__image-wrapper {
      height: 240px;
    }
  }

  @media (max-width: 480px) {
    .products-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .product-card__image-wrapper {
      height: 180px;
    }

    .product-card__info {
      padding: 12px;
    }

    .product-card__title {
      font-size: 14px;
    }

    .price {
      font-size: 16px;
    }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    // Quick view functionality
    const quickViewBtns = document.querySelectorAll('.product-card__quickview');
    quickViewBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const productId = btn.dataset.productId;
        console.log('Quick view for product:', productId);
        // Implement quick view modal here
      });
    });

    // Add to cart functionality
    const forms = document.querySelectorAll('[data-product-form]');
    forms.forEach(form => {
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(form);

        fetch('/cart/add.js', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          console.log('Added to cart:', data);
          // Update cart count/drawer
          // Show notification
          const notification = document.createElement('div');
          notification.className = 'cart-notification';
          notification.textContent = 'Product added to cart!';
          document.body.appendChild(notification);

          setTimeout(() => {
            notification.remove();
          }, 3000);
        })
        .catch(error => console.error('Error:', error));
      });
    });
  });
{% endjavascript %}

{% schema %}
{
  "name": "Trending Products",
  "tag": "section",
  "class": "section-trending",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Trending now"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_limit",
      "label": "Number of products",
      "min": 4,
      "max": 12,
      "step": 1,
      "default": 8
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View All Link Text",
      "default": "View all products"
    },
    {
      "type": "url",
      "id": "view_all_url",
      "label": "View All Link URL"
    },
    {
      "type": "checkbox",
      "id": "show_sizes",
      "label": "Show size options",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Trending Products"
    }
  ]
}
{% endschema %}